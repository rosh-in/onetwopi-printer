# Home Assistant automation to detect missed calls
# Add thiss to automations.yaml or create as individual automation

alias: "Missed Call Detection"
description: "Detect missed calls and send notification to Raspberry Pi"
trigger:
  # Trigger when phone state changes from ringing back to idle (missed call)
  - platform: state
    entity_id: sensor.phone_state
    from: "ringing"
    to: "idle"
condition: []
action:
  # Send HTTP request to your Raspberry Pi
  - service: rest_command.send_missed_call
    data:
      caller: "{{ trigger.from_state.attributes.get('caller_name', 'Unknown') }}"
      number: "{{ trigger.from_state.attributes.get('caller_number', 'Unknown') }}"
      timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
mode: single

---
# Add this to your configuration.yaml to define the REST command

rest_command:
  send_missed_call:
    url: "http://YOUR_PI_IP:5000/missed_call"
    method: POST
    headers:
      content-type: "application/json"
    payload: >
      {
        "caller": "{{ caller }}",
        "number": "{{ number }}",
        "time": "{{ timestamp }}",
        "source": "home_assistant"
      }